### PostMaster - Master controller

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Postmaster (PID 1) ğŸ‘‘      â”‚  â† Boss of ALL processes
â”‚   Listens: 5432             â”‚
â”‚   Children: 4000 processes  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚    â”‚    â”‚
   â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â–¼â”€â”€â”€â”€â–¼â”€â”€â”€â”
   â”‚ Backend #1 #2...#4000 â”‚  â† YOUR PgPool connections
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Postmaster's 3 Jobs

```text
1ï¸âƒ£ LISTENS = Door Bell on Port 5432
    Postmaster sits at your house door (port 5432) ğŸ 

    Rust app knocks: "I need database!"
    Postmaster: "Come in! Here's PID 12347 ğŸ§‘â€ğŸ³"

TCP Connection Flow:
    Rust â†’ tcp:5432 â†’ Postmaster â†’ "Take PID 12347"
    PID 12347 does YOUR SQL â†’ Returns to door
2ï¸âƒ£ FORKS = Makes New Processes
    PgPool grabs connection #1:
    Postmaster: "FORK â†’ NEW PID 12347!" ğŸ“‹
    PID 12347 does SQL â†’ Returns to pool

    PgPool grabs connection #2 (5 seconds later):
    Postmaster: "FORK â†’ NEW PID 12456!" ğŸ“‹ â† DIFFERENT PID!
    PID 12456 does SQL â†’ Returns to pool
3ï¸âƒ£ MANAGES LIFE CYCLE
    pg_ctl start    â†’ Postmaster ğŸ‘‘ born
    Rust connects   â†’ Postmaster forks 4000 PIDs
    pg_ctl stop     â†’ Child PIDs die first â†’ Postmaster last
    pg_ctl restart  â†’ New Postmaster ğŸ‘‘ + new PIDs
```

```text
Postmaster:

âœ… Listens on port 5432 (door bell) ğŸ””
âœ… Forks NEW processes (makes workers) ğŸ“‹
âœ… Manages start/stop/restart (boss duties) ğŸ‘‘
âŒ NEVER touches your data
âŒ NEVER runs SQL queries
âŒ NEVER reads shared_buffers

```

```text
1. RUST SERVER PID 5000 ğŸ¦€
   - Your Rust app running (separate process)
   - Sends "SELECT users" over TCP

2. POSTMASTER PID 12345 ğŸ‘‘
   - PostgreSQL boss process
   - Listens on port 5432
   - Forks backend processes

3. BACKEND PID 12347 ğŸ—„ï¸
   - PostgreSQL worker process
   - Does ALL SQL work (parse/plan/execute)
   - Connected to Rust via TCP

```

### Flow

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     TCP 5432     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     FORK     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Rust        â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚ Postmaster  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚ Backend     â”‚
â”‚ PID 5000    â”‚                   â”‚ PID 12345   â”‚              â”‚ PID 12347   â”‚
â”‚ PgPool(400) â”‚                   â”‚ ğŸ‘‘ Boss     â”‚              â”‚ ğŸ—„ï¸ Worker   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†‘                                   â†‘                           â†‘
     â”‚â”€â”€Sends SQLâ”€â”€                      â”‚â”€â”€Listens/Forksâ”€â”€          â”‚â”€â”€Executes SQL
     â”‚â”€â”€Gets JSONâ”€â”€                      â””â”€â”€(NO SQL work!)â”€â”€         â””â”€â”€Reads shared_buffers

```

```text
Rust PID 5000:           Postmaster PID 12345:     Backend/POSTGRESQL EXECUTOR PID 12347:
âœ… Runs your Rust code     âœ… Listens port 5432      âœ… Parse "SELECT users"
âœ… PgPool grabs conn       âœ… Forks Backend PIDs     âœ… Plan: Use index?
âœ… Sends SQL strings       âœ… Start/stop server      âœ… Execute: Read 16GB cache
âœ… Gets JSON response      âŒ NO SQL execution!     âœ… Return JSON to Rust
```
