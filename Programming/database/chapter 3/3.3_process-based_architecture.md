## #### 3.3 PostgreSQL - Process-Based Architecture

- Process vs Thread: How Databases Handle YOUR Requests ğŸ¢ vs ğŸ 
- Core Difference: MEMORY ISOLATION

| MySQL (Threads)                          | PostgreSQL (Processes)                 |
| ---------------------------------------- | -------------------------------------- |
| Shared kitchen ğŸ 1 bug = ALL 4000 die ğŸ”¥ | Private apartments ğŸ¢1 bug = 1 dies âœ… |
| 4000 conns = 400MB RAM ğŸ’°                | 4000 conns = 8GB RAM ğŸ’                |

### How Your 10K Users Hit Database

```text
Your Rust App (1 instance) â† 10K users clicking simultaneously
â†“
PgPool(max_size=400) â† Borrows 1 of 400 connections
â†“
Postmaster ğŸ‘‘ â† Forks Backend Process for each connection
```

### MySQL: Shared Dorm Disaster ğŸ˜µ

```text
4000 Users â†’ 4000 Threads in 1 Dorm ğŸ 

User1: "SELECT users" â†’ Thread1 (kitchen)
User2: "UPDATE balance" â†’ Thread2 (kitchen)
User3: ğŸ›BUG! â†’ **FIRE!** â†’ Threads 1,2,4,5...4000 **ALL DIE** ğŸ˜µ
```

### PostgreSQL: Safe Apartments âœ…

```text
Postmaster ğŸ‘‘ (Apartment Manager)
â”œâ”€â”€ Apartment1 (Process1) â† User1: "SELECT users" âœ…
â”œâ”€â”€ Apartment2 (Process2) â† User2: "UPDATE balance" âœ…
â”œâ”€â”€ Apartment3 (Process3) â† User3: ğŸ›BUG! **ONLY #3 burns** ğŸ”¥
â”œâ”€â”€ Apartment4...4000 â† Still working âœ…
```

```text
Backend Process #1 (Connection #1):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1 Main Thread ğŸ‘·             â”‚  â† Does ALL SQL work
â”‚ Private Memory (2MB)        â”‚  â† Sorts, calculations
â”‚                            â”‚
â”‚ â†• SHARED memory (16GB) â†•    â”‚  â† shared_buffers cache
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Simple Meaning

- 1 Thread = Handles ALL requests for THIS connection
- Private Memory = Each process has its own 2MB workspace
- Shared memory = ALL processes read from SAME 16GB cache (super fast!)

```text
User1 sends 1000 requests â†’ SAME Process #1 does all 1000 ğŸ‘·
Process #1: "Parse â†’ Plan â†’ Check shared memory â†’ Return results â†’ Wait"
```
